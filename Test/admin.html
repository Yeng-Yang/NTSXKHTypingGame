<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - ‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫ö‡∫ª‡∫î‡∫Å‡∫ß‡∫î‡∫Å‡∫≤</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .admin-section {
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }
        .admin-section h2 {
            color: #0056b3;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 95%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: 'Noto Sans Lao', sans-serif;
        }
        .info-text {
            font-size: 0.9em;
            color: #666;
        }
        #scores-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        #scores-table th, #scores-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        #scores-table th {
            background-color: #f2f2f2;
            color: #333;
            font-weight: bold;
        }
        #questions-list .question-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            margin-bottom: 8px;
            background-color: #f9f9f9;
        }
        #questions-list .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .matching-pair {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 5px;
        }
        .matching-pair input[type="text"] {
            flex: 1;
        }
        .matching-pair .delete-pair-btn {
            background-color: #ffc107;
            color: #333;
            border: none;
            padding: 5px 8px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            line-height: 1;
        }

    </style>
</head>
<body>

    <!-- ‡ªÄ‡∫û‡∫µ‡ªà‡∫° Library SheetJS ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <div class="quiz-container">
        <h1>‚öôÔ∏è Admin Panel - ‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫ö‡∫ª‡∫î‡∫Å‡∫ß‡∫î‡∫Å‡∫≤</h1>

        <!-- Section ‡∫™‡ªâ‡∫≤‡∫á‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫° -->
        <form id="add-question-form" class="admin-section">
            <h2>1. ‡∫™‡ªâ‡∫≤‡∫á‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡ªÉ‡ªù‡ªà</h2>
            <div class="form-group">
                <label for="q-type">‡∫õ‡∫∞‡ªÄ‡∫û‡∫î‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°:</label>
                <select id="q-type">
                    <option value="multiple-choice">‡∫õ‡∫≤‡∫•‡∫∞‡ªÑ‡∫ô</option>
                    <option value="fill-in">‡∫≠‡∫±‡∫î‡∫ï‡∫∞‡ªÑ‡∫ô</option>
                    <option value="image-multiple-choice">‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö‡∫õ‡∫≤‡∫•‡∫∞‡ªÑ‡∫ô</option>
                    <option value="image-fill-in">‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö‡∫≠‡∫±‡∫î‡∫ï‡∫∞‡ªÑ‡∫ô</option>
                    <option value="matching-text-text">‡∫à‡∫±‡∫ö‡∫Ñ‡∫π‡ªà (‡∫ï‡∫ª‡∫ß‡ªú‡∫±‡∫á‡∫™‡∫∑-‡∫ï‡∫ª‡∫ß‡ªú‡∫±‡∫á‡∫™‡∫∑)</option>
                    <option value="matching-text-image">‡∫à‡∫±‡∫ö‡∫Ñ‡∫π‡ªà (‡∫ï‡∫ª‡∫ß‡ªú‡∫±‡∫á‡∫™‡∫∑-‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="q-text">‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°:</label>
                <textarea id="q-text" rows="2"></textarea>
            </div>
            <div class="form-group" id="q-image-group">
                <label for="q-image-upload">‡∫≠‡∫±‡∫ö‡ªÇ‡∫´‡∫º‡∫î‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö (‡∫ñ‡ªâ‡∫≤‡∫°‡∫µ):</label>
                <input type="file" id="q-image-upload" accept="image/*">
                <img id="q-image-preview" src="" alt="‡∫ï‡∫ª‡∫ß‡∫¢‡ªà‡∫≤‡∫á‡∫Æ‡∫π‡∫ö" style="max-width: 100px; max-height: 100px; display: none; margin-top: 10px; border-radius: 5px;">
                <!-- ‡ªÉ‡∫ä‡ªâ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫Å‡∫±‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫Æ‡∫π‡∫ö‡ªÅ‡∫ö‡∫ö Base64 -->
                <input type="hidden" id="q-image-base64">
            </div>
            <div class="form-group" id="q-options-group">
                <label for="q-options">‡∫ï‡∫ª‡∫ß‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å (‡ªÅ‡∫ç‡∫Å‡ªÅ‡∫ï‡ªà‡∫•‡∫∞‡∫ï‡∫ª‡∫ß‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫î‡ªâ‡∫ß‡∫ç‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡ªù‡∫≤‡∫ç‡∫à‡∫∏‡∫î ,):</label>
                <input type="text" id="q-options" placeholder="‡∫ï‡∫ª‡∫ß‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å ‡∫Å, ‡∫ï‡∫ª‡∫ß‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å ‡∫Ç, ‡∫ï‡∫ª‡∫ß‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å ‡∫Ñ">
            </div>
            <div class="form-group" id="q-answer-group">
                <label for="q-answer">‡∫Ñ‡∫≥‡∫ï‡∫≠‡∫ö‡∫ó‡∫µ‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á:</label>
                <input type="text" id="q-answer" placeholder="‡∫õ‡ªâ‡∫≠‡∫ô‡∫Ñ‡∫≥‡∫ï‡∫≠‡∫ö‡∫ó‡∫µ‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á‡∫≠‡∫±‡∫ô‡∫î‡∫Ω‡∫ß">
            </div>
            <!-- Container for matching pairs -->
            <div id="matching-pairs-container" class="form-group" style="display: none;">
                <label>‡∫Ñ‡∫π‡ªà‡∫Ñ‡∫≥‡∫ï‡∫≠‡∫ö:</label>
                <div id="matching-pairs-list">
                    <!-- Dynamic pairs will be added here -->
                </div>
                <button type="button" id="add-pair-btn" style="margin-top: 10px;">+ ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫Ñ‡∫π‡ªà</button>
            </div>
            <button id="add-q-btn" class="submit-btn" style="background-color: #28a745;">+ ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°</button>
        </form>

        <!-- Section ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô -->
        <div class="admin-section">
            <h2>2. ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô</h2>
            <div class="form-group">
                <label for="excel-file-input">‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡ªÑ‡∫ü‡∫•‡ªå Excel ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫ô‡∫≥‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà:</label>
                <input type="file" id="excel-file-input" accept=".xlsx, .xls">
                <p class="info-text">
                    <strong>‡∫Ñ‡∫≥‡ªÅ‡∫ô‡∫∞‡∫ô‡∫≥:</strong> ‡ªÑ‡∫ü‡∫•‡ªå Excel ‡∫Ñ‡∫ß‡∫ô‡∫°‡∫µ <strong>‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô (ID) ‡∫¢‡∫π‡ªà‡∫ñ‡∫±‡∫ô‡∫ó‡∫µ‡∫™‡∫≤‡∫° (Column C)</strong>.
                </p>
            </div>
            <div id="students-preview-container" style="margin-top: 15px;"></div>
            <button type="button" id="confirm-import-btn" class="submit-btn" style="display: none; background-color: #28a745; margin-top: 10px;">‚úÖ ‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡∫ô‡∫≥‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤</button>
        </div>

        <!-- Section ‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡ªÉ‡∫ô‡∫•‡∫∞‡∫ö‡∫ª‡∫ö -->
        <div class="admin-section">
            <h2>3. ‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡ªÉ‡∫ô‡∫•‡∫∞‡∫ö‡∫ª‡∫ö</h2>
            <button type="button" id="delete-all-students-btn" class="submit-btn" style="background-color: #dc3545; margin-bottom: 15px;">üóëÔ∏è ‡∫•‡∫∂‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</button>
            <div id="all-students-list">
                <!-- ‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡∫à‡∫∞‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫¢‡∫π‡ªà‡∫ö‡ªà‡∫≠‡∫ô‡∫ô‡∫µ‡ªâ -->
            </div>
        </div>

        <!-- Section ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô -->
        <div class="admin-section">
            <h2>4. ‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô</h2>
            <button id="export-scores-btn" class="submit-btn" style="background-color: #17a2b8;">üì§ Export ‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡ªÄ‡∫õ‡∫±‡∫ô Excel</button>
            <button type="button" id="delete-all-scores-btn" class="submit-btn" style="background-color: #dc3545; margin-top: 10px;">üóëÔ∏è ‡∫•‡∫∂‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</button>
            <div id="scores-list"></div>
        </div>

        <!-- Section ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫° -->
        <div class="admin-section">
            <h2>5. ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</h2>
            <div id="questions-list"></div>
        </div>
        
        <!-- Section ‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÄ‡∫ß‡∫•‡∫≤ -->
        <div class="admin-section">
            <h2>6. ‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫Å‡∫≤‡∫ô‡∫™‡∫≠‡∫ö‡ªÄ‡∫™‡∫±‡∫á</h2>
            <button type="button" id="start-quiz-btn" class="submit-btn" style="background-color: #28a745;">üöÄ ‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡∫Å‡∫≤‡∫ô‡∫™‡∫≠‡∫ö‡ªÄ‡∫™‡∫±‡∫á</button>
            <button type="button" id="stop-quiz-btn" class="submit-btn" style="background-color: #dc3545; margin-top: 10px;">üõë ‡∫¢‡∫∏‡∫î‡∫Å‡∫≤‡∫ô‡∫™‡∫≠‡∫ö‡ªÄ‡∫™‡∫±‡∫á</button>
            <div id="quiz-status-display" style="text-align: center; font-size: 1.2em; font-weight: bold; margin-top: 15px; color: #0056b3;"></div>
        </div>
        
        <p id="status-message" style="text-align:center; color: green; font-weight: bold;"></p>

    </div>

    <script>
        const addQuestionBtn = document.getElementById('add-q-btn');
        const fileInput = document.getElementById('excel-file-input');
        const confirmImportBtn = document.getElementById('confirm-import-btn');
        const exportScoresBtn = document.getElementById('export-scores-btn');
        const statusMessage = document.getElementById('status-message');
        const questionsListDiv = document.getElementById('questions-list');
        const addQuestionForm = document.getElementById('add-question-form');
        const scoresListDiv = document.getElementById('scores-list');
        const studentsPreviewContainer = document.getElementById('students-preview-container');
        const qImageUpload = document.getElementById('q-image-upload');
        const qImagePreview = document.getElementById('q-image-preview');
        const qImageBase64 = document.getElementById('q-image-base64');
        const qTypeSelect = document.getElementById('q-type');
        const qImageGroup = document.getElementById('q-image-group');
        const qOptionsGroup = document.getElementById('q-options-group');
        const qAnswerGroup = document.getElementById('q-answer-group');
        const matchingPairsContainer = document.getElementById('matching-pairs-container');
        const addPairBtn = document.getElementById('add-pair-btn');
        const deleteAllStudentsBtn = document.getElementById('delete-all-students-btn');
        const deleteAllScoresBtn = document.getElementById('delete-all-scores-btn');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const stopQuizBtn = document.getElementById('stop-quiz-btn');
        const quizStatusDisplay = document.getElementById('quiz-status-display');
        const allStudentsListDiv = document.getElementById('all-students-list');
        let studentsToImport = []; // ‡∫ï‡∫ª‡∫ß‡ªÅ‡∫õ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫Å‡∫±‡∫ö‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ä‡∫ª‡ªà‡∫ß‡∫Ñ‡∫≤‡∫ß (Object {name, id})

        // Function ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°
        function renderQuestions() {
            const questions = JSON.parse(localStorage.getItem('quiz_questions') || '[]');
            questionsListDiv.innerHTML = ''; // ‡∫•‡ªâ‡∫≤‡∫á‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡ªÄ‡∫Å‡∫ª‡ªà‡∫≤‡∫≠‡∫≠‡∫Å‡∫Å‡ªà‡∫≠‡∫ô

            if (questions.length === 0) {
                questionsListDiv.innerHTML = '<p>‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡ªÉ‡∫ô‡∫•‡∫∞‡∫ö‡∫ª‡∫ö.</p>';
                return;
            }

            questions.forEach((q, index) => {
                const item = document.createElement('div');
                item.className = 'question-item';
                item.innerHTML = `
                    <span>${index + 1}. ${q.question.substring(0, 50)}${q.question.length > 50 ? '...' : ''}</span>
                    <button class="delete-btn" data-index="${index}">‡∫•‡∫∂‡∫ö</button>
                `;
                questionsListDiv.appendChild(item);
            });
        }

        // Function ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫•‡∫∂‡∫ö‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°
        function deleteQuestion(index) {
            if (confirm(`‡∫ó‡ªà‡∫≤‡∫ô‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡ªà‡∫ß‡ªà‡∫≤‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡∫ó‡∫µ ${index + 1}?`)) {
                let questions = JSON.parse(localStorage.getItem('quiz_questions') || '[]');
                questions.splice(index, 1); // ‡∫•‡∫∂‡∫ö‡∫≠‡∫≠‡∫Å‡∫à‡∫≤‡∫Å array
                localStorage.setItem('quiz_questions', JSON.stringify(questions)); // ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫Å‡∫±‡∫ö
                renderQuestions(); // ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ú‡∫ª‡∫ô‡ªÉ‡ªù‡ªà
                showStatus('‡∫•‡∫∂‡∫ö‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!', 'red');
            }
        }

        // Function ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô
        function renderScores() {
            const scores = JSON.parse(localStorage.getItem('quiz_scores') || '[]');
            scoresListDiv.innerHTML = '';

            if (scores.length === 0) {
                scoresListDiv.innerHTML = '<p>‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô.</p>';
                return;
            }

            let table = '<table id="scores-table"><thead><tr><th>‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô</th><th>‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô (‡ªÄ‡∫ï‡∫±‡∫° 10)</th><th>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ‡∫™‡∫≠‡∫ö‡ªÄ‡∫™‡∫±‡∫á</th></tr></thead><tbody>';
            scores.forEach(score => {
                table += `
                    <tr>
                        <td>${score.studentId}</td>
                        <td>${score.score}</td>
                        <td>${new Date(score.date).toLocaleString('lo-LA')}</td>
                    </tr>
                `;
            });
            table += '</tbody></table>';
            scoresListDiv.innerHTML = table;
        }

        // Function ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡ªÉ‡∫ô‡∫•‡∫∞‡∫ö‡∫ª‡∫ö
        function renderAllStudents() {
            const students = JSON.parse(localStorage.getItem('quiz_students_data') || '[]');
            allStudentsListDiv.innerHTML = '';

            if (students.length === 0) {
                allStudentsListDiv.innerHTML = '<p>‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡ªÉ‡∫ô‡∫•‡∫∞‡∫ö‡∫ª‡∫ö.</p>';
                return;
            }

            let table = `<table id="scores-table">
                            <thead><tr><th>‡∫•‡∫≥‡∫î‡∫±‡∫ö</th><th>‡∫ä‡∫∑‡ªà ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô</th><th>ID ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô</th></tr></thead>
                            <tbody>`;
            students.forEach((student, index) => {
                table += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${student.name}</td>
                        <td>${student.id}</td>
                    </tr>
                `;
            });
            table += '</tbody></table>';
            allStudentsListDiv.innerHTML = table;
        }

        // Function ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô
        function saveStudents(newStudentData) {
            let students = JSON.parse(localStorage.getItem('quiz_students_data') || '[]');
            const existingIds = students.map(s => s.id);
            const newStudents = newStudentData.filter(s => s.id && !existingIds.includes(s.id)); // ‡∫Å‡∫±‡ªà‡∫ô‡∫ï‡∫≠‡∫á ID ‡∫ó‡∫µ‡ªà‡∫ö‡ªç‡ªà‡∫°‡∫µ ‡ªÅ‡∫•‡∫∞ ‡∫ä‡ªâ‡∫≥
            
            students = [...students, ...newStudents];
            localStorage.setItem('quiz_students_data', JSON.stringify(students));
            showStatus(`‡∫ô‡∫≥‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤ ${newStudents.length} ‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡ªÉ‡ªù‡ªà‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!`);
        }

        // Function ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫™‡∫∞‡∫ñ‡∫≤‡∫ô‡∫∞
        function showStatus(message, color = 'green') {
            statusMessage.textContent = message;
            statusMessage.style.color = color;
            setTimeout(() => { statusMessage.textContent = ''; }, 3000);
        }

        // Function ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫™‡∫∞‡ªÅ‡∫î‡∫á/‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫á‡∫ü‡∫≠‡∫°‡∫ï‡∫≤‡∫°‡∫õ‡∫∞‡ªÄ‡∫û‡∫î‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°
        function updateFormVisibility() {
            const selectedType = qTypeSelect.value;
            qImageGroup.style.display = selectedType.includes('image') ? 'block' : 'none';
            qOptionsGroup.style.display = selectedType.includes('multiple-choice') ? 'block' : 'none';
            qAnswerGroup.style.display = !selectedType.includes('matching') ? 'block' : 'none';
            matchingPairsContainer.style.display = selectedType.includes('matching') ? 'block' : 'none';

            // Clear pairs when switching away from matching type
            if (!selectedType.includes('matching')) {
                document.getElementById('matching-pairs-list').innerHTML = '';
            }
        }

        // Function to add a new pair for matching questions
        function addMatchingPair() {
            const list = document.getElementById('matching-pairs-list');
            const pairDiv = document.createElement('div');
            pairDiv.className = 'matching-pair';
            const selectedType = qTypeSelect.value;

            let pairHTML = `<input type="text" class="matching-term" placeholder="‡∫Ñ‡∫≥‡∫™‡∫±‡∫ö...">`;

            if (selectedType === 'matching-text-text') {
                pairHTML += `<input type="text" class="matching-match-text" placeholder="‡∫Ñ‡∫≥‡∫≠‡∫∞‡∫ó‡∫¥‡∫ö‡∫≤‡∫ç...">`;
            } else if (selectedType === 'matching-text-image') {
                pairHTML += `<input type="file" class="matching-match-image" accept="image/*">`;
            }

            pairHTML += `<button type="button" class="delete-pair-btn">X</button>`;
            pairDiv.innerHTML = pairHTML;

            list.appendChild(pairDiv);
        }

        // Event listener for adding pairs
        addPairBtn.addEventListener('click', addMatchingPair);

        // Event listener for deleting pairs (using event delegation)
        document.getElementById('matching-pairs-list').addEventListener('click', function(e) {
            if (e.target && e.target.classList.contains('delete-pair-btn')) {
                e.target.closest('.matching-pair').remove();
            }
        });
        
        // ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°
        addQuestionForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // ‡∫õ‡ªâ‡∫≠‡∫á‡∫Å‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡ªÇ‡∫´‡∫º‡∫î‡ªú‡ªâ‡∫≤‡ªÄ‡∫ß‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô
            const type = qTypeSelect.value;
            let newQuestion = { type: type, question: document.getElementById('q-text').value };

            if (type.includes('matching')) {
                const pairs = [];
                const pairElements = document.querySelectorAll('.matching-pair');
                
                for (const pairEl of pairElements) {
                    const term = pairEl.querySelector('.matching-term').value;
                    if (!term) continue;

                    let match;
                    if (type === 'matching-text-text') {
                        match = pairEl.querySelector('.matching-match-text').value;
                    } else if (type === 'matching-text-image') {
                        const fileInput = pairEl.querySelector('.matching-match-image');
                        if (fileInput && fileInput.files[0]) {
                            // Convert image to Base64
                            match = await new Promise((resolve) => {
                                const reader = new FileReader();
                                reader.onload = (e) => resolve(e.target.result);
                                reader.readAsDataURL(fileInput.files[0]);
                            });
                        }
                    }
                    if (match) pairs.push({ term, match });
                }
                newQuestion.pairs = pairs;

                if (!newQuestion.question || pairs.length < 2) {
                    alert('‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫õ‡ªâ‡∫≠‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡∫´‡∫º‡∫±‡∫Å ‡ªÅ‡∫•‡∫∞ ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫¢‡ªà‡∫≤‡∫á‡ªú‡ªâ‡∫≠‡∫ç 2 ‡∫Ñ‡∫π‡ªà!');
                    return;
                }
            } else {
                newQuestion.image = qImageBase64.value || undefined;
                newQuestion.options = document.getElementById('q-options').value.split(',').map(opt => opt.trim());
                newQuestion.answer = document.getElementById('q-answer').value.trim();

                if (!newQuestion.question || !newQuestion.answer) {
                    alert('‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫õ‡ªâ‡∫≠‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫° ‡ªÅ‡∫•‡∫∞ ‡∫Ñ‡∫≥‡∫ï‡∫≠‡∫ö!');
                    return;
                }
            }

            if (!newQuestion.question) {
                alert('‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫õ‡ªâ‡∫≠‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡∫´‡∫º‡∫±‡∫Å!');
                return;
            }

            let questions = JSON.parse(localStorage.getItem('quiz_questions') || '[]');
            questions.push(newQuestion);
            localStorage.setItem('quiz_questions', JSON.stringify(questions));
            showStatus('‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!');
            addQuestionForm.reset(); // ‡∫•‡ªâ‡∫≤‡∫á‡∫ü‡∫≠‡∫°
            // ‡∫•‡ªâ‡∫≤‡∫á‡∫ï‡∫ª‡∫ß‡∫¢‡ªà‡∫≤‡∫á‡∫Æ‡∫π‡∫ö ‡ªÅ‡∫•‡∫∞ ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô Base64
            qImagePreview.style.display = 'none';
            qImagePreview.src = '';
            qImageBase64.value = '';
            qImageUpload.value = '';

            renderQuestions(); // ‡∫≠‡∫±‡∫ö‡ªÄ‡∫î‡∫î‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°

            // ‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô‡ªÑ‡∫õ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ü‡∫≠‡∫°‡∫ï‡∫≤‡∫°‡∫Ñ‡ªà‡∫≤‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡∫ï‡∫ª‡ªâ‡∫ô
            updateFormVisibility();
        });

        // ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ï‡∫ª‡∫ß‡∫¢‡ªà‡∫≤‡∫á‡∫Æ‡∫π‡∫ö‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡∫≠‡∫±‡∫ö‡ªÇ‡∫´‡∫º‡∫î
        qImageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    qImagePreview.src = e.target.result;
                    qImagePreview.style.display = 'block';
                    qImageBase64.value = e.target.result; // ‡ªÄ‡∫Å‡∫±‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô Base64 ‡ªÑ‡∫ß‡ªâ
                };
                reader.readAsDataURL(file);
            }
        });

        // 1. ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ï‡∫ª‡∫ß‡∫¢‡ªà‡∫≤‡∫á‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫≠‡∫±‡∫î‡∫ï‡∫∞‡ªÇ‡∫ô‡∫°‡∫±‡∫î‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡ªÑ‡∫ü‡∫•‡ªå Excel
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) {
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                // ‡ªÅ‡∫õ‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÉ‡∫ô sheet ‡ªÄ‡∫õ‡∫±‡∫ô JSON, header: 1 ‡ªù‡∫≤‡∫ç‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ß‡ªà‡∫≤‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡∫à‡∫≤‡∫Å‡ªÅ‡∫ñ‡∫ß‡∫ó‡∫≥‡∫≠‡∫¥‡∫î
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                // ‡∫Å‡∫±‡ªà‡∫ô‡∫ï‡∫≠‡∫á‡ªÄ‡∫≠‡∫ª‡∫≤‡ªÅ‡∫ñ‡∫ß‡∫ó‡∫µ‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô ID ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô (‡∫ñ‡∫±‡∫ô‡∫ó‡∫µ 3)
                studentsToImport = jsonData
                    .filter(row => row && typeof row[2] !== 'undefined' && row[2] !== null && String(row[2]).trim() !== '') // ‡∫Å‡∫±‡ªà‡∫ô‡ªÄ‡∫≠‡∫ª‡∫≤‡ªÅ‡∫ñ‡∫ß‡∫ó‡∫µ‡ªà‡∫°‡∫µ ID
                    .map(row => ({
                        name: row[1] || '‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫ä‡∫∑‡ªà', // ‡∫ñ‡∫±‡∫ô B
                        id: String(row[2]).trim() // ‡∫ñ‡∫±‡∫ô C
                    }));

                if (studentsToImport.length > 0) {
                    let previewHtml = `<h4>‡∫ï‡∫ª‡∫ß‡∫¢‡ªà‡∫≤‡∫á‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ó‡∫µ‡ªà‡∫à‡∫∞‡∫ô‡∫≥‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤ (${studentsToImport.length} ‡∫Ñ‡∫ª‡∫ô):</h4>
                                     <table id="scores-table">
                                        <thead><tr><th>‡∫•‡∫≥‡∫î‡∫±‡∫ö</th><th>‡∫ä‡∫∑‡ªà ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô</th><th>ID ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô</th></tr></thead>
                                        <tbody>`;
                    studentsToImport.forEach((student, index) => {
                        previewHtml += `<tr>
                                          <td>${index + 1}</td>
                                          <td>${student.name}</td>
                                          <td><strong>${student.id}</strong></td>
                                        </tr>`;
                    });
                    previewHtml += '</tbody></table>';
                    studentsPreviewContainer.innerHTML = previewHtml;
                    confirmImportBtn.style.display = 'block'; // ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫õ‡∫∏‡ªà‡∫°‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô
                } else {
                    studentsPreviewContainer.innerHTML = '<p style="color: red;">‡∫ö‡ªç‡ªà‡∫û‡∫ª‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡ªÉ‡∫ô‡∫ñ‡∫±‡∫ô‡∫ó‡∫µ 3 ‡∫Ç‡∫≠‡∫á‡ªÑ‡∫ü‡∫•‡ªå.</p>';
                    confirmImportBtn.style.display = 'none';
                }
            };
            reader.readAsArrayBuffer(file);
        });

        // 2. ‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡∫ô‡∫≥‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà
        confirmImportBtn.addEventListener('click', () => {
            if (studentsToImport.length > 0) {
                saveStudents(studentsToImport);
                studentsToImport = []; // ‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ä‡∫ª‡ªà‡∫ß‡∫Ñ‡∫≤‡∫ß
                studentsPreviewContainer.innerHTML = ''; // ‡∫•‡ªâ‡∫≤‡∫á‡ªú‡ªâ‡∫≤‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ï‡∫ª‡∫ß‡∫¢‡ªà‡∫≤‡∫á
                confirmImportBtn.style.display = 'none'; // ‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫á‡∫õ‡∫∏‡ªà‡∫°‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫´‡∫º‡∫±‡∫á‡∫à‡∫≤‡∫Å‡∫ô‡∫≥‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î
                renderAllStudents(); // ‡∫≠‡∫±‡∫ö‡ªÄ‡∫î‡∫î‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡ªÉ‡∫ô‡∫•‡∫∞‡∫ö‡∫ª‡∫ö
                document.getElementById('excel-file-input').value = ''; // ‡∫•‡ªâ‡∫≤‡∫á‡ªÑ‡∫ü‡∫•‡ªå‡∫ó‡∫µ‡ªà‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å
            }
        });


        // ‡∫™‡∫ª‡ªà‡∫á‡∫≠‡∫≠‡∫Å‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡ªÄ‡∫õ‡∫±‡∫ô Excel
        exportScoresBtn.addEventListener('click', () => {
            const scores = JSON.parse(localStorage.getItem('quiz_scores') || '[]');
            const students = JSON.parse(localStorage.getItem('quiz_students_data') || '[]');

            if (scores.length === 0) {
                alert('‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫™‡∫ª‡ªà‡∫á‡∫≠‡∫≠‡∫Å!');
                return;
            }

            // ‡∫™‡ªâ‡∫≤‡∫á Map ‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÉ‡∫´‡ªâ‡∫ä‡∫≠‡∫Å‡∫´‡∫≤‡∫ä‡∫∑‡ªà‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡ªÑ‡∫î‡ªâ‡ªÑ‡∫ß‡∫Ç‡∫∂‡ªâ‡∫ô
            const studentMap = new Map(students.map(s => [s.id, s.name]));

            const dataToExport = scores.map((s, index) => ({
                '‡∫•‡∫≥‡∫î‡∫±‡∫ö': index + 1,
                '‡∫ä‡∫∑‡ªà ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô': studentMap.get(s.studentId) || '‡∫ö‡ªç‡ªà‡∫û‡∫ª‡∫ö‡∫ä‡∫∑‡ªà',
                'ID ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô': s.studentId,
                '‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô (‡ªÄ‡∫ï‡∫±‡∫° 10)': s.score
            }));

            const worksheet = XLSX.utils.json_to_sheet(dataToExport);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Scores");
            XLSX.writeFile(workbook, "Student_Scores.xlsx");
        });

        // Event listener ‡∫™‡∫≥‡∫•‡∫±‡∫ö‡∫õ‡∫∏‡ªà‡∫°‡∫•‡∫∂‡∫ö (‡ªÉ‡∫ä‡ªâ Event Delegation)
        questionsListDiv.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-btn')) {
                const index = parseInt(event.target.dataset.index, 10);
                deleteQuestion(index);
            }
        });

        // Event listener to delete all students
        deleteAllStudentsBtn.addEventListener('click', () => {
            if (confirm('‡∫ó‡ªà‡∫≤‡∫ô‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡ªà‡∫ß‡ªà‡∫≤‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡∫≠‡∫≠‡∫Å‡∫à‡∫≤‡∫Å‡∫•‡∫∞‡∫ö‡∫ª‡∫ö? ‡∫Å‡∫≤‡∫ô‡∫Å‡∫∞‡∫ó‡∫≥‡∫ô‡∫µ‡ªâ‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫Å‡∫π‡ªâ‡∫Ñ‡∫∑‡∫ô‡ªÑ‡∫î‡ªâ.')) {
                localStorage.removeItem('quiz_students_data');
                renderAllStudents(); // Re-render the (now empty) list
                showStatus('‡∫•‡∫∂‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!', 'red');
            }
        });

        // Event listener to delete all scores
        deleteAllScoresBtn.addEventListener('click', () => {
            if (confirm('‡∫ó‡ªà‡∫≤‡∫ô‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡ªà‡∫ß‡ªà‡∫≤‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î? ‡∫Å‡∫≤‡∫ô‡∫Å‡∫∞‡∫ó‡∫≥‡∫ô‡∫µ‡ªâ‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫Å‡∫π‡ªâ‡∫Ñ‡∫∑‡∫ô‡ªÑ‡∫î‡ªâ.')) {
                localStorage.removeItem('quiz_scores');
                renderScores(); // Re-render the (now empty) list
                showStatus('‡∫•‡∫∂‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!', 'red');
            }
        });

        // --- Quiz Control Logic ---
        function updateQuizStatusDisplay() {
            const status = localStorage.getItem('quiz_status');
            if (status === 'active') {
                quizStatusDisplay.textContent = 'üü¢ ‡∫™‡∫∞‡∫ñ‡∫≤‡∫ô‡∫∞: ‡∫Å‡ªç‡∫≤‡∫•‡∫±‡∫á‡∫î‡ªç‡∫≤‡ªÄ‡∫ô‡∫µ‡∫ô';
                quizStatusDisplay.style.color = '#28a745';
                startQuizBtn.disabled = true;
                stopQuizBtn.disabled = false;
            } else {
                quizStatusDisplay.textContent = 'üî¥ ‡∫™‡∫∞‡∫ñ‡∫≤‡∫ô‡∫∞: ‡∫õ‡∫¥‡∫î';
                quizStatusDisplay.style.color = '#dc3545';
                startQuizBtn.disabled = false;
                stopQuizBtn.disabled = true;
            }
        }

        startQuizBtn.addEventListener('click', () => {
            if (confirm('‡∫ó‡ªà‡∫≤‡∫ô‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡∫Å‡∫≤‡∫ô‡∫™‡∫≠‡∫ö‡ªÄ‡∫™‡∫±‡∫á‡∫ö‡ªç‡ªà? ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫à‡∫∞‡∫™‡∫≤‡∫°‡∫≤‡∫î‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫≠‡∫ö‡ªÄ‡∫™‡∫±‡∫á‡ªÑ‡∫î‡ªâ‡∫ó‡∫±‡∫ô‡∫ó‡∫µ.')) {
                localStorage.setItem('quiz_status', 'active');
                updateQuizStatusDisplay();
            }
        });

        stopQuizBtn.addEventListener('click', () => {
            if (confirm('‡∫ó‡ªà‡∫≤‡∫ô‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡ªà‡∫ß‡ªà‡∫≤‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫¢‡∫∏‡∫î‡∫Å‡∫≤‡∫ô‡∫™‡∫≠‡∫ö‡ªÄ‡∫™‡∫±‡∫á? ‡∫ô‡∫±‡∫Å‡∫Æ‡∫Ω‡∫ô‡∫ó‡∫∏‡∫Å‡∫Ñ‡∫ª‡∫ô‡∫à‡∫∞‡∫ñ‡∫∑‡∫Å‡∫ö‡∫±‡∫á‡∫Ñ‡∫±‡∫ö‡ªÉ‡∫´‡ªâ‡∫™‡∫ª‡ªà‡∫á‡∫Ñ‡∫≥‡∫ï‡∫≠‡∫ö‡∫ó‡∫±‡∫ô‡∫ó‡∫µ.')) {
                localStorage.setItem('quiz_status', 'finished');
                updateQuizStatusDisplay();
            }
        });

        // Initialize status on page load
        updateQuizStatusDisplay();
        // --- End of Quiz Control Logic ---

        // ‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡ªú‡ªâ‡∫≤‡ªÄ‡∫ß‡∫±‡∫ö‡ªÇ‡∫´‡∫º‡∫î
        renderQuestions();
        renderScores();
        renderAllStudents();

        // ‡∫ï‡∫±‡ªâ‡∫á‡∫Ñ‡ªà‡∫≤‡∫Å‡∫≤‡∫ô‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ü‡∫≠‡∫°‡ªÉ‡∫ô‡∫ï‡∫≠‡∫ô‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡∫ï‡∫ª‡ªâ‡∫ô ‡ªÅ‡∫•‡∫∞ ‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡∫°‡∫µ‡∫Å‡∫≤‡∫ô‡∫õ‡ªà‡∫Ω‡∫ô‡ªÅ‡∫õ‡∫á
        qTypeSelect.addEventListener('change', updateFormVisibility);
        updateFormVisibility(); // ‡ªÄ‡∫≠‡∫µ‡ªâ‡∫ô‡ªÉ‡∫ä‡ªâ‡∫ï‡∫≠‡∫ô‡ªÇ‡∫´‡∫º‡∫î‡ªú‡ªâ‡∫≤‡ªÄ‡∫ß‡∫±‡∫ö

    </script>
</body>
</html>