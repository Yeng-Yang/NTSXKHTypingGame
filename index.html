<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∫ç‡∫≠‡∫î‡∫ß‡∫¥‡∫•‡∫∞‡∫ä‡∫ª‡∫ô‡∫ô‡ªâ‡∫≠‡∫ç‡∫û‡∫¥‡∫ä‡∫¥‡∫î‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô - 2D (Complete Character Set)</title>
    <style>
        /* CSS ‡∫ç‡∫±‡∫á‡∫Ñ‡∫ª‡∫á‡ªÄ‡∫î‡∫µ‡∫°... */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        #game-container {
            width: 800px;
            height: 500px;
            border: 5px solid #4CAF50;
            background-color: #000033;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        #player {
            position: absolute;
            left: 50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
            color: #00796B;
            padding: 10px;
            background: #B2DFDB;
            border-radius: 5px;
            font-weight: bold;
            z-index: 5; 
        }

        .enemy {
            position: absolute;
            right: 0;
            width: 60px;
            height: 60px;
            background-color: #FFCDD2;
            border: 2px solid #D32F2F;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            font-weight: bold;
            color: #D32F2F;
            transition: background-color 0.1s; 
            cursor: pointer;
            z-index: 2; 
        }

        .bullet {
            position: absolute;
            width: 15px;
            height: 5px;
            background-color: #FFC107; 
            border-radius: 2px;
            z-index: 4; 
        }
        
        .enemy-bullet {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #D32F2F; 
            border-radius: 50%;
            z-index: 4; 
        }

        #stats {
            width: 800px;
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px 0;
            font-size: 18px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            padding: 0 15px;
            text-align: center;
        }

        .stat-item span {
            font-weight: bold;
            color: #388E3C;
        }

        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            font-weight: bold;
            color: #F44336;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            z-index: 10;
            display: none;
            text-align: center;
        }

        #start-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }

        .lang-button {
            padding: 15px 30px;
            margin: 10px;
            font-size: 24px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
        }

        #lao-btn { background-color: #FFEB3B; color: #333; }
        #en-btn { background-color: #2196F3; color: white; }

        #controls {
            width: 800px;
            margin-top: 15px;
            display: flex;
            justify-content: center;
        }
        
        .control-button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
        }

        #restart-btn { background-color: #4CAF50; color: white; }
        #exit-btn { background-color: #F44336; color: white; }
        
        #progress-display {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 10;
        }
    </style>
</head>
<body>

    <h1>‡∫ç‡∫≠‡∫î‡∫ß‡∫¥‡∫•‡∫∞‡∫ä‡∫ª‡∫ô‡∫ô‡ªâ‡∫≠‡∫ç‡∫û‡∫¥‡∫ä‡∫¥‡∫î‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô (2D Complete Character Set)</h1>

    <div id="game-container">
        <div id="player">üöÄ</div>

        <div id="start-screen">
            <h2>‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫û‡∫≤‡∫™‡∫≤ / Choose Language</h2>
            <button id="lao-btn" class="lang-button">‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß</button>
            <button id="en-btn" class="lang-button">English</button>
            <p style="margin-top: 20px;">**‡∫Å‡∫ª‡∫î‡∫õ‡∫∏‡ªà‡∫°‡∫ó‡∫µ‡ªà‡∫Å‡∫ª‡∫á‡∫Å‡∫±‡∫ö‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡ªÄ‡∫ó‡∫¥‡∫á‡∫™‡∫±‡∫î‡∫ï‡∫π‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫ç‡∫¥‡∫á**</p>
            <p>**‡∫ï‡ªâ‡∫≠‡∫á‡∫û‡∫¥‡∫°‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡ªÉ‡∫ô Level ‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫ª‡∫ö‡∫à‡∫∂‡ªà‡∫á‡∫à‡∫∞‡∫Ç‡∫∂‡ªâ‡∫ô Level ‡ªÉ‡ªù‡ªà‡ªÑ‡∫î‡ªâ!**</p>
        </div>
        
        <div id="message"></div>
        <div id="progress-display"></div>

    </div>

    <div id="stats">
        <div class="stat-item">Level: <span id="level-display">1</span></div>
        <div class="stat-item">‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô: <span id="score-display">0</span></div>
        <div class="stat-item" style="color: #D32F2F;">‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ: <span id="damage-display">0</span> / 15</div>
        <div class="stat-item" style="color: #388E3C;">‡∫û‡∫¥‡∫°‡∫ñ‡∫∑‡∫Å: <span id="correct-display">0</span></div>
        <div class="stat-item" style="color: #FBC02D;">‡∫û‡∫¥‡∫°‡∫ú‡∫¥‡∫î: <span id="incorrect-display">0</span></div>
    </div>
    
    <div id="controls" style="display: none;">
        <button id="restart-btn" class="control-button">üîÑ ‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡ªÄ‡∫Å‡∫°‡ªÉ‡ªù‡ªà</button>
        <button id="exit-btn" class="control-button">üè† ‡∫≠‡∫≠‡∫Å‡∫à‡∫≤‡∫Å‡ªÄ‡∫Å‡∫° (Menu)</button>
    </div>

    <script>
        /* -------------------------- */
        /* JavaScript ‡∫™‡ªç‡∫≤‡∫•‡∫±‡∫ö‡∫Å‡∫≤‡∫ô‡∫´‡∫º‡∫¥‡ªâ‡∫ô‡ªÄ‡∫Å‡∫° */
        /* -------------------------- */

        // ‡ªÇ‡∫Ñ‡∫á‡∫™‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô Level
        // 'count' ‡∫ö‡ªç‡ªà‡∫ñ‡∫∑‡∫Å‡∫ô‡∫≥‡ªÉ‡∫ä‡ªâ‡ªÉ‡∫ô Mode ‡∫ô‡∫µ‡ªâ, ‡ªÅ‡∫ï‡ªà 'speed' ‡ªÅ‡∫•‡∫∞ 'lao'/'en' ‡∫ç‡∫±‡∫á‡∫ñ‡∫∑‡∫Å‡∫ô‡∫≥‡ªÉ‡∫ä‡ªâ
        const levels = {
            1: { lao: ['‡∫Å', '‡∫Ç', '‡∫Ñ', '‡∫á', '‡∫à'], en: ['A', 'B', 'C', 'D', 'E'], speed: 1.0 },
            2: { lao: ['‡∫ä', '‡∫ç', '‡∫î', '‡∫ï', '‡∫ñ'], en: ['F', 'G', 'H', 'I', 'J'], speed: 1.2 },
            3: { lao: ['‡∫ó', '‡∫ô', '‡∫ö', '‡∫õ', '‡∫ú'], en: ['K', 'L', 'M', 'N', 'O'], speed: 1.4 },
            4: { lao: ['‡∫ù', '‡∫û', '‡∫ü', '‡∫°', '‡∫¢'], en: ['P', 'Q', 'R', 'S', 'T'], speed: 1.6 },
            5: { lao: ['‡∫£', '‡∫•', '‡∫ß', '‡∫™', '‡∫´'], en: ['U', 'V', 'W', 'X', 'Y', 'Z'], speed: 1.8 },
            6: { lao: ['‡∫Å', '‡∫Ç', '‡∫Ñ', '‡∫á', '‡∫à', '‡∫≠', '‡∫Æ'], en: ['A', 'E', 'I', 'O', 'U'], speed: 2.0 }, 
            7: { lao: ['‡∫Å', '‡∫∞', '‡∫≤', '‡∫Ç', '‡ªÄ', '‡ªÅ'], en: ['a', 'b', 'c', 'd', 'e'], speed: 2.2 },
            8: { lao: ['‡ªÇ', '‡ªÉ', '‡ªÑ', '‡∫î', '‡∫ï', '‡∫ñ'], en: ['f', 'g', 'h', 'i', 'j'], speed: 2.4 },
            9: { lao: ['‡∫Ω', '‡∫∂', '‡∫∑', '‡∫∏', '‡∫π', '‡∫ó'], en: ['k', 'l', 'm', 'n', 'o', 'p'], speed: 2.6 },
            10: { lao: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'], en: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'], speed: 2.8 },
            11: { lao: ['‡∫Å‡ªà', '‡∫Ç‡ªâ', '‡∫Ñ‡ªä', '‡∫á‡ªã', '‡∫à'], en: ['A', 'a', 'B', 'b', 'C', 'c', 'D', 'd'], speed: 3.0 },
            12: { lao: ['‡∫Å', '‡∫≤', '‡ªà', '1', '‡∫Ç', '‡∫∂', '‡ªâ', '2'], en: ['A', 'a', '1', 'B', 'b', '2'], speed: 3.2 }
        };

        // ‡∫ï‡∫ª‡∫ß‡∫õ‡ªà‡∫Ω‡∫ô‡ªÄ‡∫Å‡∫°
        let currentLanguage = '';
        let currentLevel = 1;
        let score = 0;
        let damage = 0;
        let correctHits = 0;
        let incorrectHits = 0;
        const maxDamage = 15;
        let isGameOver = false;
        let currentEnemy = null; 
        
        // **‡∫ï‡∫ª‡∫ß‡∫õ‡ªà‡∫Ω‡∫ô‡ªÉ‡ªù‡ªà‡∫™‡∫≥‡∫•‡∫±‡∫ö Logic ‡ªÉ‡ªù‡ªà**
        let charactersRemaining = []; // ‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫ç‡∫±‡∫á‡ªÄ‡∫´‡∫º‡∫∑‡∫≠‡ªÉ‡∫ô Level
        let allCharactersInLevel = []; // ‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡ªÉ‡∫ô Level

        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const messageDisplay = document.getElementById('message');
        const controlsDiv = document.getElementById('controls');
        const progressDisplay = document.getElementById('progress-display');
        
        // Displays
        const damageDisplay = document.getElementById('damage-display');
        const scoreDisplay = document.getElementById('score-display');
        const correctDisplay = document.getElementById('correct-display');
        const incorrectDisplay = document.getElementById('incorrect-display');
        const levelDisplay = document.getElementById('level-display');
        
        // Buttons
        const startScreen = document.getElementById('start-screen');
        const restartBtn = document.getElementById('restart-btn');
        const exitBtn = document.getElementById('exit-btn');
        
        // ===================================
        // ‡∫Å‡∫≤‡∫ô‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫™‡∫Ω‡∫á
        // ===================================

        const audio = {
            shoot: new Audio('shoot_sound.wav'),        
            explosion: new Audio('explosion_sound.wav'), 
            error: new Audio('error_sound.wav'),    
            gameOver: new Audio('gameover_sound.wav'), 
            levelUp: new Audio('level_up_sound.wav'),
            damage: new Audio('damage_sound.wav') 
        };
        
        function playAudio(type) {
            if (audio[type]) {
                audio[type].currentTime = 0; 
                audio[type].play().catch(e => console.log("Audio play blocked:", e)); 
            }
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡∫≠‡∫±‡∫ö‡ªÄ‡∫î‡∫î‡∫™‡∫∞‡∫ñ‡∫¥‡∫ï‡∫¥
        function updateStats() {
            damageDisplay.textContent = damage;
            scoreDisplay.textContent = score;
            correctDisplay.textContent = correctHits;
            incorrectDisplay.textContent = incorrectHits;
            levelDisplay.textContent = currentLevel;
            
            // ‡∫≠‡∫±‡∫ö‡ªÄ‡∫î‡∫î Progress ‡∫Ç‡∫≠‡∫á Level
            const totalChars = allCharactersInLevel.length;
            const completedChars = totalChars - charactersRemaining.length;
            progressDisplay.textContent = currentLanguage === 'lao' 
                ? `Progress: ${completedChars} / ${totalChars} ‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô` 
                : `Progress: ${completedChars} / ${totalChars} Characters`;
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡ªâ‡∫≤‡∫á‡∫™‡∫±‡∫î‡∫ï‡∫π‡ªÇ‡∫ï‡∫ï‡ªç‡ªà‡ªÑ‡∫õ
        function spawnNextEnemy() {
            if (isGameOver) return;
            if (currentEnemy && currentEnemy.parentElement) return; 
            
            // NEW: ‡∫ñ‡ªâ‡∫≤‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡ªÄ‡∫´‡∫º‡∫∑‡∫≠‡ªÅ‡∫•‡ªâ‡∫ß, ‡ªÉ‡∫´‡ªâ‡∫Ç‡∫∂‡ªâ‡∫ô Level
            if (charactersRemaining.length === 0) {
                checkLevelComplete();
                return;
            }

            // NEW: ‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫™‡∫∞‡ªÄ‡∫û‡∫≤‡∫∞‡∫à‡∫≤‡∫Å‡∫ó‡∫µ‡ªà‡∫ç‡∫±‡∫á‡ªÄ‡∫´‡∫º‡∫∑‡∫≠
            const randomChar = charactersRemaining[Math.floor(Math.random() * charactersRemaining.length)];
            const randomY = Math.max(30, Math.min(470, Math.random() * (gameContainer.clientHeight - 60))); 

            const enemy = document.createElement('div');
            enemy.classList.add('enemy');
            enemy.textContent = randomChar;
            enemy.setAttribute('data-char', randomChar);
            enemy.style.top = `${randomY}px`;
            enemy.style.right = `-60px`; 
            
            enemy.setAttribute('data-pos-x', gameContainer.offsetWidth - 30); 
            enemy.setAttribute('data-pos-y', randomY + 30); 

            gameContainer.appendChild(enemy);
            currentEnemy = enemy; 

            moveEnemy(enemy);
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫Ç‡∫≠‡∫á‡∫™‡∫±‡∫î‡∫ï‡∫π (2D)
        function moveEnemy(enemy) {
            const speed = levels[currentLevel].speed;
            const moveInterval = 20; 
            const speedMultiplier = speed * 1.5; 

            const interval = setInterval(() => {
                if (isGameOver || !enemy.parentElement) {
                    clearInterval(interval);
                    return;
                }

                let currentRight = parseFloat(enemy.style.right) || 0;
                let newRight = currentRight + speedMultiplier; 
                
                let currentX = gameContainer.offsetWidth - newRight; 

                if (currentX <= player.offsetWidth + player.offsetLeft) { 
                    clearInterval(interval);
                    
                    enemyAttack(enemy, true); 
                    
                    if (currentEnemy === enemy) {
                        currentEnemy = null;
                    }
                    enemy.remove();
                    spawnNextEnemy(); 
                    return;
                }

                enemy.style.right = `${newRight}px`;
                enemy.setAttribute('data-pos-x', currentX - 30); 
                
            }, moveInterval);

            enemy.setAttribute('data-interval', interval);
        }
        
        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡ªâ‡∫≤‡∫á ‡ªÅ‡∫•‡∫∞ ‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫•‡∫π‡∫Å‡∫õ‡∫∑‡∫ô‡∫ú‡∫π‡ªâ‡∫´‡∫º‡∫¥‡ªâ‡∫ô (Visible Bullet + Guaranteed Hit)
        function createBullet(targetEnemy) {
            if (!targetEnemy || !targetEnemy.parentElement) return; 
            
            playAudio('shoot');

            const playerX = player.offsetLeft + player.offsetWidth;
            const playerY = player.offsetTop + (player.offsetHeight / 2) - 2.5;
            
            const bullet = document.createElement('div');
            bullet.classList.add('bullet');
            bullet.style.top = `${playerY}px`;
            bullet.style.left = `${playerX}px`;
            gameContainer.appendChild(bullet);

            const BULLET_SPEED = 25; 
            const moveInterval = 10; 

            const bulletInterval = setInterval(() => {
                if (isGameOver || !targetEnemy.parentElement) {
                    clearInterval(bulletInterval);
                    bullet.remove();
                    return;
                }

                const targetX = parseFloat(targetEnemy.getAttribute('data-pos-x'));
                const targetY = parseFloat(targetEnemy.getAttribute('data-pos-y'));
                
                let currentX = parseFloat(bullet.style.left);
                let currentY = parseFloat(bullet.style.top);
                
                const deltaX = targetX - currentX;
                const deltaY = targetY - currentY;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

                if (distance < BULLET_SPEED) {
                    clearInterval(bulletInterval);
                    bullet.remove();
                    hitEnemy(targetEnemy);
                    return;
                }
                
                const ratio = BULLET_SPEED / distance;
                const moveX = deltaX * ratio;
                const moveY = deltaY * ratio;
                
                bullet.style.left = `${currentX + moveX}px`;
                bullet.style.top = `${currentY + moveY}px`;

            }, moveInterval);
        }
        
        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡∫±‡∫î‡∫ï‡∫π‡ªÇ‡∫à‡∫°‡∫ï‡∫µ (‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡∫û‡∫¥‡∫°‡∫ú‡∫¥‡∫î ‡∫´‡∫º‡∫∑ ‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫Æ‡∫≠‡∫î‡∫ï‡∫ª‡∫ß‡ªÄ‡∫Æ‡∫ª‡∫≤)
        function enemyAttack(aggressor, isOverrun = false) {
             if (isGameOver) return;
             
             if (!aggressor) {
                 aggressor = currentEnemy;
             }

             if (!aggressor || !aggressor.parentElement) {
                 if(!isOverrun) takeDamage(null, false); 
                 return;
             }
             
             const aggressorX = parseFloat(aggressor.getAttribute('data-pos-x'));
             const aggressorY = parseFloat(aggressor.getAttribute('data-pos-y')) - 5; 
             
             const targetX = player.offsetLeft + (player.offsetWidth / 2);
             const targetY = player.offsetTop + (player.offsetHeight / 2);
             
             const bullet = document.createElement('div');
             bullet.classList.add('enemy-bullet');
             bullet.style.top = `${aggressorY}px`;
             bullet.style.left = `${aggressorX}px`;
             gameContainer.appendChild(bullet);

             const BULLET_SPEED = 15; 
             const moveInterval = 10; 

             const bulletInterval = setInterval(() => {
                 if (isGameOver) {
                     clearInterval(bulletInterval);
                     bullet.remove();
                     return;
                 }
                 
                 let currentX = parseFloat(bullet.style.left);
                 let currentY = parseFloat(bullet.style.top);
                 
                 const deltaX = targetX - currentX;
                 const deltaY = targetY - currentY;
                 const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

                 if (distance < BULLET_SPEED) {
                     clearInterval(bulletInterval);
                     bullet.remove();
                     takeDamage(aggressor, isOverrun); 
                     return;
                 }
                 
                 const ratio = BULLET_SPEED / distance;
                 const moveX = deltaX * ratio;
                 const moveY = deltaY * ratio;
                 
                 bullet.style.left = `${currentX + moveX}px`;
                 bullet.style.top = `${currentY + moveY}px`;

             }, moveInterval);
             
             if (!isOverrun) {
                aggressor.style.backgroundColor = '#FF5252';
                setTimeout(() => {
                    aggressor.style.backgroundColor = '#FFCDD2';
                }, 200);
             }
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ (Take Damage - ‡ªÄ‡∫≠‡∫µ‡ªâ‡∫ô‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡∫•‡∫π‡∫Å‡∫õ‡∫∑‡∫ô‡∫™‡∫±‡∫î‡∫ï‡∫π‡∫ä‡∫ª‡∫ô)
        function takeDamage(aggressor, isOverrun) {
            if (isGameOver) return;
            
            playAudio('damage'); 
            
            damage++;
            damageDisplay.style.color = '#F44336';
            
            setTimeout(() => { damageDisplay.style.color = '#D32F2F'; }, 100);
            
            updateStats();

            if (damage >= maxDamage) {
                endGame(currentLanguage === 'lao' ? '‡ªÄ‡∫Å‡∫°‡∫à‡∫ª‡∫ö! ‡∫ó‡ªà‡∫≤‡∫ô‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ 15 ‡∫Ñ‡∫±‡ªâ‡∫á' : 'GAME OVER! You took 15 hits');
            }
        }
        
        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫ç‡∫¥‡∫á‡∫ñ‡∫∑‡∫Å (Hit)
        function hitEnemy(enemy) {
            if (!enemy || !enemy.parentElement) return; 
            
            const charHit = enemy.getAttribute('data-char');

            // NEW: ‡ªÄ‡∫≠‡∫ª‡∫≤‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫û‡∫¥‡∫°‡∫ñ‡∫∑‡∫Å‡∫≠‡∫≠‡∫Å‡∫à‡∫≤‡∫Å‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ó‡∫µ‡ªà‡∫ç‡∫±‡∫á‡ªÄ‡∫´‡∫º‡∫∑‡∫≠
            const index = charactersRemaining.indexOf(charHit);
            if (index > -1) {
                charactersRemaining.splice(index, 1);
            }

            playAudio('explosion'); 
            
            clearInterval(parseInt(enemy.getAttribute('data-interval')));
            
            enemy.style.backgroundColor = '#8BC34A'; 
            enemy.textContent = 'üí•'; 
            score += 10;
            correctHits++;
            
            if (currentEnemy === enemy) {
                currentEnemy = null;
            }
            
            setTimeout(() => {
                enemy.remove();
                spawnNextEnemy(); 
            }, 100);
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫Å‡∫ß‡∫î‡∫™‡∫≠‡∫ö Level (NEW: ‡∫Å‡∫ß‡∫î‡ªÄ‡∫ö‡∫¥‡ªà‡∫á CharactersRemaining)
        function checkLevelComplete() {
            if (charactersRemaining.length === 0) {
                if (currentLevel < 12) {
                    playAudio('levelUp'); 
                    
                    currentLevel++;
                    
                    // NEW: ‡ªÇ‡∫´‡∫º‡∫î‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡ªÉ‡ªù‡ªà‡∫™‡∫≥‡∫•‡∫±‡∫ö Level ‡ªÉ‡ªù‡ªà
                    const charSet = levels[currentLevel][currentLanguage];
                    allCharactersInLevel = [...charSet]; 
                    charactersRemaining = [...charSet]; 

                    const nextLevelMsg = currentLanguage === 'lao' 
                        ? `‡∫ú‡ªà‡∫≤‡∫ô Level ${currentLevel - 1} ‡ªÅ‡∫•‡ªâ‡∫ß! ‡ªÑ‡∫õ Level ${currentLevel}` 
                        : `Level ${currentLevel - 1} Complete! Next Level: ${currentLevel}`;
                    
                    messageDisplay.textContent = nextLevelMsg;
                    messageDisplay.style.display = 'block';
                    
                    setTimeout(() => {
                        messageDisplay.style.display = 'none';
                        spawnNextEnemy(); 
                        updateStats();
                    }, 3000);
                } else {
                    endGame(currentLanguage === 'lao' ? '‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î! ‡∫ó‡ªà‡∫≤‡∫ô‡∫Ñ‡∫∑‡∫ç‡∫≠‡∫î‡∫ß‡∫¥‡∫•‡∫∞‡∫ä‡∫ª‡∫ô‡ªÇ‡∫ï‡∫à‡∫¥‡∫á!' : 'CONGRATULATIONS! You are a true Letter Hero!');
                }
            }
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫õ‡∫∏‡ªà‡∫°‡∫Å‡∫ª‡∫î
        document.addEventListener('keydown', (e) => {
            if (isGameOver || currentLanguage === '') return;

            let typedChar = e.key;
            
            // ‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫û‡∫≤‡∫™‡∫≤‡∫≠‡∫±‡∫á‡∫Å‡∫¥‡∫î‡ªÉ‡∫´‡∫ç‡ªà/‡∫ô‡ªâ‡∫≠‡∫ç
            if (currentLanguage === 'en') {
                 // ‡∫ñ‡ªâ‡∫≤‡ªÄ‡∫õ‡∫±‡∫ô‡ªÇ‡∫ï‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô, ‡∫õ‡ªà‡∫Ω‡∫ô‡ªÉ‡∫´‡ªâ‡∫Å‡∫ª‡∫á‡∫Å‡∫±‡∫ö‡ªÇ‡∫ï‡∫ó‡∫µ‡ªà‡∫¢‡∫π‡ªà‡ªÉ‡∫ô charactersRemaining (‡ªÄ‡∫ä‡∫±‡ªà‡∫ô: A ‡∫ç‡∫¥‡∫á‡∫ñ‡∫∑‡∫Å a, ‡∫´‡∫º‡∫∑ a ‡∫ç‡∫¥‡∫á‡∫ñ‡∫∑‡∫Å A)
                 typedChar = typedChar.toUpperCase();
            }
            
            const targetEnemy = currentEnemy; 

            if (targetEnemy) {
                let enemyChar = targetEnemy.getAttribute('data-char');
                
                let targetCharForMatch = enemyChar;
                if (currentLanguage === 'en') {
                    targetCharForMatch = targetCharForMatch.toUpperCase();
                }
                
                // NEW: ‡∫õ‡∫Ω‡∫ö‡∫ó‡∫Ω‡∫ö‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫û‡∫¥‡∫°‡∫Å‡∫±‡∫ö‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡ªÄ‡∫õ‡∫ª‡ªâ‡∫≤‡ªù‡∫≤‡∫ç (‡∫ó‡∫µ‡ªà‡∫õ‡ªà‡∫Ω‡∫ô‡ªÄ‡∫õ‡∫±‡∫ô‡ªÇ‡∫ï‡ªÉ‡∫´‡∫ç‡ªà‡ªÅ‡∫•‡ªâ‡∫ß‡∫ñ‡ªâ‡∫≤‡ªÄ‡∫õ‡∫±‡∫ô EN)
                if (targetCharForMatch === typedChar) {
                    // ‡∫û‡∫¥‡∫°‡∫ñ‡∫∑‡∫Å: ‡∫ç‡∫¥‡∫á‡∫õ‡∫∑‡∫ô
                    createBullet(targetEnemy); 
                } else {
                    // ‡∫û‡∫¥‡∫°‡∫ú‡∫¥‡∫î:
                    incorrectHits++;
                    playAudio('error'); 
                    enemyAttack(targetEnemy, false); 
                }
            } else {
                // ‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫™‡∫±‡∫î‡∫ï‡∫π
                incorrectHits++;
                playAudio('error');
            }
            updateStats();
        });


        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡∫¥‡ªâ‡∫ô‡∫™‡∫∏‡∫î‡ªÄ‡∫Å‡∫°
        function endGame(msg) {
            playAudio('gameOver'); 
            
            isGameOver = true;
            document.querySelectorAll('.enemy').forEach(e => clearInterval(parseInt(e.getAttribute('data-interval'))));
            
            messageDisplay.textContent = msg;
            messageDisplay.style.display = 'block';
            messageDisplay.style.color = '#F44336';
            
            controlsDiv.style.display = 'flex';
        }
        
        function restartGame() {
            initializeGame(currentLanguage);
        }
        
        function exitToMenu() {
            isGameOver = true;
            document.querySelectorAll('.enemy').forEach(e => clearInterval(parseInt(e.getAttribute('data-interval'))));
            
            document.querySelectorAll('.enemy').forEach(e => e.remove()); 
            document.querySelectorAll('.bullet').forEach(b => b.remove()); 
            document.querySelectorAll('.enemy-bullet').forEach(b => b.remove()); 
            
            controlsDiv.style.display = 'none';
            messageDisplay.style.display = 'none';
            startScreen.style.display = 'flex';
            
            currentLanguage = ''; 
            currentEnemy = null; 
        }


        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡ªÄ‡∫Å‡∫° (‡∫õ‡∫±‡∫ö‡∫õ‡∫∏‡∫á‡∫Å‡∫≤‡∫ô‡ªÇ‡∫´‡∫º‡∫î‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô)
        function initializeGame(lang) {
            // **‡∫Å‡∫≤‡∫ô‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫ö‡∫±‡∫ô‡∫´‡∫≤‡∫™‡∫Ω‡∫á**
            Object.values(audio).forEach(sound => {
                sound.muted = true;
                sound.play().catch(e => console.log("Silent play blocked:", e));
                sound.muted = false;
                sound.pause();
                sound.currentTime = 0;
            });
            
            currentLanguage = lang;
            currentLevel = 1;
            score = 0;
            damage = 0;
            correctHits = 0;
            incorrectHits = 0;
            isGameOver = false;
            currentEnemy = null;
            
            // NEW: ‡ªÇ‡∫´‡∫º‡∫î‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫Ç‡∫≠‡∫á Level 1
            const charSet = levels[currentLevel][currentLanguage];
            allCharactersInLevel = [...charSet]; 
            charactersRemaining = [...charSet]; // ‡∫™‡∫≥‡ªÄ‡∫ô‡∫ª‡∫≤‡∫•‡∫≤‡∫ç‡∫ä‡∫∑‡ªà‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î

            startScreen.style.display = 'none';
            controlsDiv.style.display = 'none';
            document.querySelectorAll('.enemy').forEach(e => e.remove()); 
            document.querySelectorAll('.bullet').forEach(b => b.remove()); 
            document.querySelectorAll('.enemy-bullet').forEach(b => b.remove()); 
            messageDisplay.style.display = 'none';

            updateStats();
            spawnNextEnemy(); 
        }

        // ‡∫ú‡∫π‡ªâ‡ªÉ‡∫ä‡ªâ‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫û‡∫≤‡∫™‡∫≤ (Start Screen)
        document.getElementById('lao-btn').addEventListener('click', () => initializeGame('lao'));
        document.getElementById('en-btn').addEventListener('click', () => initializeGame('en'));
        
        // ‡∫ú‡∫π‡∫Å‡∫õ‡∫∏‡ªà‡∫°‡∫Ñ‡∫ß‡∫ö‡∫Ñ‡∫∏‡∫°
        restartBtn.addEventListener('click', restartGame);
        exitBtn.addEventListener('click', exitToMenu);

    </script>

</body>
</html>
