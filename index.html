<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∫ç‡∫≠‡∫î‡∫ß‡∫¥‡∫•‡∫∞‡∫ä‡∫ª‡∫ô‡∫ô‡ªâ‡∫≠‡∫ç‡∫û‡∫¥‡∫ä‡∫¥‡∫î‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô - 2D (‡∫Ç‡∫∞‡∫´‡∫ç‡∫≤‡∫ç‡∫à‡ªç + ‡∫û‡∫∑‡ªâ‡∫ô‡∫´‡∫º‡∫±‡∫á‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö)</title>
    <style>
        /* -------------------------- */
        /* CSS ‡∫û‡∫∑‡ªâ‡∫ô‡∫ñ‡∫≤‡∫ô ‡ªÅ‡∫•‡∫∞ Font */
        /* -------------------------- */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        #game-container {
            width: 1000px; /* ‡∫Ç‡∫∞‡∫´‡∫ç‡∫≤‡∫ç‡∫Ñ‡∫ß‡∫≤‡∫°‡∫Å‡∫ß‡ªâ‡∫≤‡∫á */
            height: 700px; /* ‡∫Ç‡∫∞‡∫´‡∫ç‡∫≤‡∫ç‡∫Ñ‡∫ß‡∫≤‡∫°‡∫™‡∫π‡∫á */
            border: 5px solid #4CAF50;
            background-color: transparent; /* ‡∫ï‡∫±‡ªâ‡∫á‡ªÉ‡∫´‡ªâ‡ªÇ‡∫õ‡ªà‡∫á‡ªÉ‡∫™‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫´‡∫±‡∫ô‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö */
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            font-family: 'Times New Roman', serif;
        }

        /* ******* CSS ‡∫™‡ªç‡∫≤‡∫•‡∫±‡∫ö‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö‡∫û‡∫∑‡ªâ‡∫ô‡∫´‡∫º‡∫±‡∫á (‡ªÉ‡∫ä‡ªâ‡ªÅ‡∫ó‡∫±‡∫Å IMG) ******* */
        #game-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* ‡∫õ‡∫±‡∫ö‡ªÉ‡∫´‡ªâ‡ªÄ‡∫ï‡∫±‡∫°‡∫à‡ªç */
            z-index: 1; /* ‡ªÉ‡∫´‡ªâ‡∫¢‡∫π‡ªà‡∫ä‡∫±‡ªâ‡∫ô‡∫•‡∫∏‡ªà‡∫°‡∫™‡∫∏‡∫î */
        }
        /* ************************************************* */


        .lao-font {
            font-family: 'Phetsarath OT', 'Saysettha OT', sans-serif !important;
        }

        .en-font {
            font-family: 'Times New Roman', serif !important;
        }

        /* -------------------------- */
        /* Game Elements */
        /* -------------------------- */
        #player {
            position: absolute;
            left: 50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
            color: #4DB6AC; /* ‡∫™‡∫µ‡∫ü‡ªâ‡∫≤‡∫≠‡ªà‡∫≠‡∫ô/‡∫Ç‡∫Ω‡∫ß‡∫≠‡ªà‡∫≠‡∫ô (Cyber) */
            padding: 10px;
            background: rgba(0, 0, 0, 0.8); /* ‡∫û‡∫∑‡ªâ‡∫ô‡∫´‡∫º‡∫±‡∫á‡∫°‡∫∑‡∫î */
            border-radius: 5px;
            font-weight: bold;
            z-index: 5; /* ‡∫ï‡ªâ‡∫≠‡∫á‡∫™‡∫π‡∫á‡∫Å‡∫ß‡ªà‡∫≤‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö */
            display: none;
            box-shadow: 0 0 10px #4DB6AC; 
        }

        .enemy {
            position: absolute;
            right: 0;
            width: 60px;
            height: 60px;
            background-color: rgba(255, 165, 0, 0.9); /* ‡∫™‡∫µ‡∫™‡∫ª‡ªâ‡∫°‡ªÄ‡∫î‡∫±‡ªà‡∫ô */
            border: 2px solid #FF8C00; 
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            font-weight: bold;
            color: #000000; /* ‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫™‡∫µ‡∫î‡∫≥‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÉ‡∫´‡ªâ‡ªÄ‡∫´‡∫±‡∫ô‡∫ä‡∫±‡∫î */
            transition: background-color 0.1s; 
            z-index: 3; /* ‡∫ï‡ªâ‡∫≠‡∫á‡∫™‡∫π‡∫á‡∫Å‡∫ß‡ªà‡∫≤‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö */
        }

        .bullet {
            position: absolute;
            width: 15px;
            height: 5px;
            background-color: #FFC107; /* ‡∫™‡∫µ‡ªÄ‡∫´‡∫º‡∫∑‡∫≠‡∫á‡∫™‡ªà‡∫≠‡∫á‡ªÅ‡∫™‡∫á */
            border-radius: 2px;
            z-index: 4; 
        }
        
        .enemy-bullet {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #D32F2F; 
            border-radius: 50%;
            z-index: 4; 
        }

        #progress-display {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFFF00; /* ‡∫õ‡∫±‡∫ö‡ªÄ‡∫õ‡∫±‡∫ô‡∫™‡∫µ‡ªÄ‡∫´‡∫º‡∫∑‡∫≠‡∫á‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÄ‡∫î‡∫±‡ªà‡∫ô‡∫Ç‡∫∂‡ªâ‡∫ô‡ªÄ‡∫ó‡∫¥‡∫á‡∫û‡∫∑‡ªâ‡∫ô‡∫´‡∫º‡∫±‡∫á */
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 10;
            display: none;
        }

        /* -------------------------- */
        /* Interface (Stats, Screens) */
        /* -------------------------- */
        #stats {
            width: 1000px; /* ‡∫Å‡∫ß‡ªâ‡∫≤‡∫á‡ªÄ‡∫ó‡∫ª‡ªà‡∫≤‡∫Å‡∫±‡∫ö game-container */
            display: none; 
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px 0;
            font-size: 18px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            padding: 0 15px;
            text-align: center;
        }

        /* Start Screen Overlay */
        #start-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        
        .lang-button {
            padding: 15px 30px;
            margin: 10px;
            font-size: 24px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
        }

        /* End Game Screen Overlay (‡ªÅ‡∫ö‡∫ö‡∫™‡∫µ‡∫î‡∫≥) */
        #end-game-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #000000; 
            z-index: 21;
            display: none; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        
        #end-game-screen h2 {
            font-size: 48px;
            margin-bottom: 30px; 
            color: #FF6347; 
        }

        #end-game-details {
            margin: 20px 0;
            padding: 30px;
            background-color: #222222; 
            border-radius: 10px;
            border: 2px solid #555555;
            text-align: left;
            font-size: 24px;
            color: #FFFFFF; 
            width: 70%; 
            max-width: 450px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #end-game-details p {
            margin: 10px 0;
            display: flex;
            justify-content: space-between; 
        }
        
        #end-game-details .value {
            font-weight: bold;
            color: #FFD700; 
        }
        
        #end-game-details .accuracy-value {
             color: #FFD700; 
        }

        #end-game-buttons {
            display: flex;
            justify-content: center;
            margin-top: 25px;
        }
        
        .control-button {
            padding: 15px 30px;
            margin: 0 15px;
            font-size: 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        
    </style>
</head>
<body>
    <div><a href="https://script.google.com/macros/s/AKfycbxPDlXVOgRL627UabDB1V4DPPqeEJoipQcNoSY_KbL4Yyb_agSWBY-vlxuTne14Me_G/exec
              target="_blank" class="w-full btn-secondary w-1/3 bg-yellow-500 hover:bg-yellow-600" id="question-btn">
              ‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡∫Ñ‡∫≥‡∫ñ‡∫≤‡∫°
            </a></div>

    <h1 class="lao-font">‡∫ç‡∫≠‡∫î‡∫ß‡∫¥‡∫•‡∫∞‡∫ä‡∫ª‡∫ô‡∫ô‡ªâ‡∫≠‡∫ç‡∫û‡∫¥‡∫ä‡∫¥‡∫î‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô (2D Complete)</h1>

    <div id="game-container" class="lao-font">
        <img id="game-background" src="Generated Image October 15, 2025 - 4_28PM.png" alt="Game Background" />
        <div id="player">üöÄ</div>

        <div id="start-screen" class="lao-font">
            <h2>‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫û‡∫≤‡∫™‡∫≤ / Choose Language</h2>
            <button id="lao-btn" class="lang-button">‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß</button>
            <button id="en-btn" class="lang-button">English</button>
            <p style="margin-top: 20px;">**‡∫Å‡∫ª‡∫î‡∫õ‡∫∏‡ªà‡∫°‡∫ó‡∫µ‡ªà‡∫Å‡∫ª‡∫á‡∫Å‡∫±‡∫ö‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡ªÄ‡∫ó‡∫¥‡∫á‡∫™‡∫±‡∫î‡∫ï‡∫π‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫ç‡∫¥‡∫á**</p>
            <p>**‡∫ï‡ªâ‡∫≠‡∫á‡∫û‡∫¥‡∫°‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡ªÉ‡∫ô Level ‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫ª‡∫ö‡∫à‡∫∂‡ªà‡∫á‡∫à‡∫∞‡∫Ç‡∫∂‡ªâ‡∫ô Level ‡ªÉ‡ªù‡ªà‡ªÑ‡∫î‡ªâ!**</p>
        </div>
        
        <div id="end-game-screen" class="lao-font">
            <h2 id="end-game-message">‡ªÄ‡∫Å‡∫°‡∫à‡∫ª‡∫ö! ‡∫ó‡ªà‡∫≤‡∫ô‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ 15 ‡∫Ñ‡∫±‡ªâ‡∫á</h2>
            <div id="end-game-details"></div>
            <div id="end-game-buttons">
                 <button id="restart-btn-end" class="control-button" style="background-color: #4CAF50;">üîÑ ‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡ªÄ‡∫Å‡∫°‡ªÉ‡ªù‡ªà</button>
                 <button id="exit-btn-end" class="control-button" style="background-color: #F44336;">üè† ‡ªú‡ªâ‡∫≤‡∫´‡∫º‡∫±‡∫Å</button>
            </div>
        </div>
        
        <div id="message"></div>
        <div id="progress-display"></div>

    </div>

    <div id="stats" class="lao-font">
        <div class="stat-item">Level: <span id="level-display">1</span></div>
        <div class="stat-item">‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô: <span id="score-display">0</span></div>
        <div class="stat-item" style="color: #D32F2F;">‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ: <span id="damage-display">0</span> / 15</div>
        <div class="stat-item" style="color: #388E3C;">‡∫û‡∫¥‡∫°‡∫ñ‡∫∑‡∫Å: <span id="correct-display">0</span></div>
        <div class="stat-item" style="color: #FBC02D;">‡∫û‡∫¥‡∫°‡∫ú‡∫¥‡∫î: <span id="incorrect-display">0</span></div>
    </div>
    
    <script>
        /* -------------------------- */
        /* JavaScript ‡∫™‡ªç‡∫≤‡∫•‡∫±‡∫ö‡∫Å‡∫≤‡∫ô‡∫´‡∫º‡∫¥‡ªâ‡∫ô‡ªÄ‡∫Å‡∫° */
        /* -------------------------- */

        // ‡ªÇ‡∫Ñ‡∫á‡∫™‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô Level
        const levels = {
            1: { lao: ['‡∫Å', '‡∫Ç', '‡∫Ñ', '‡∫á', '‡∫à'], en: ['A', 'B', 'C', 'D', 'E'], speed: 1.0 },
            2: { lao: ['‡∫ä', '‡∫ç', '‡∫î', '‡∫ï', '‡∫ñ'], en: ['F', 'G', 'H', 'I', 'J'], speed: 1.2 },
            3: { lao: ['‡∫ó', '‡∫ô', '‡∫ö', '‡∫õ', '‡∫ú'], en: ['K', 'L', 'M', 'N', 'O'], speed: 1.4 },
            4: { lao: ['‡∫ù', '‡∫û', '‡∫ü', '‡∫°', '‡∫¢'], en: ['P', 'Q', 'R', 'S', 'T'], speed: 1.6 },
            5: { lao: ['‡∫£', '‡∫•', '‡∫ß', '‡∫™', '‡∫´'], en: ['U', 'V', 'W', 'X', 'Y', 'Z'], speed: 1.8 },
            6: { lao: ['‡∫≠', '‡∫Æ', '‡∫∞', '‡∫≤', '‡∫¥'], en: ['A', 'E', 'I', 'O', 'U'], speed: 2.0 }, 
            7: { lao: ['‡∫µ', '‡∫∂', '‡∫∑', '‡∫∏', '‡∫π', '‡ªÄ'], en: ['a', 'b', 'c', 'd', 'e'], speed: 2.2 },
            8: { lao: ['‡ªÅ', '‡ªÇ', '‡ªÉ', '‡ªÑ', '‡ªç', '‡∫Ω'], en: ['f', 'g', 'h', 'i', 'j'], speed: 2.4 },
            9: { lao: ['‡ªà', '‡ªâ', '‡ªä', '‡ªã', '‡ªú', '‡∫ç'], en: ['k', 'l', 'm', 'n', 'o', 'p'], speed: 2.6 },
            10: { lao: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'], en: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'], speed: 2.8 },
            11: { lao: ['‡∫Å', '‡∫∞', '1', '‡∫Ç', '‡∫∂', '2', '‡∫Ñ', '‡ªÄ', '3'], en: ['A', 'a', '1', 'B', 'b', '2'], speed: 3.0 },
            12: { lao: ['‡∫Å', '‡∫≤', '‡ªà', '1', '‡∫Ç', '‡∫∂', '‡ªâ', '2'], en: ['A', 'a', '1', 'B', 'b', '2', 'C', 'c', '3'], speed: 3.2 }
        };

        // ‡∫ï‡∫ª‡∫ß‡∫õ‡ªà‡∫Ω‡∫ô‡ªÄ‡∫Å‡∫°
        let currentLanguage = '';
        let currentLevel = 1;
        let score = 0;
        let damage = 0;
        let correctHits = 0;
        let incorrectHits = 0;
        const maxDamage = 15;
        let isGameOver = false;
        let currentEnemy = null; 
        
        let charactersRemaining = []; 
        let allCharactersInLevel = []; 

        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const messageDisplay = document.getElementById('message');
        const progressDisplay = document.getElementById('progress-display');
        const h1Title = document.querySelector('h1');
        
        // Elements ‡∫Ç‡∫≠‡∫á‡ªú‡ªâ‡∫≤‡∫à‡ªç‡∫™‡∫∞‡∫´‡∫º‡∫∏‡∫ö‡∫ú‡∫ª‡∫ô
        const endGameScreen = document.getElementById('end-game-screen');
        const endGameMessage = document.getElementById('end-game-message');
        const endGameDetails = document.getElementById('end-game-details'); 
        
        // Displays
        const damageDisplay = document.getElementById('damage-display');
        const scoreDisplay = document.getElementById('score-display');
        const correctDisplay = document.getElementById('correct-display');
        const incorrectDisplay = document.getElementById('incorrect-display');
        const levelDisplay = document.getElementById('level-display');
        
        // Buttons
        const startScreen = document.getElementById('start-screen');
        const restartBtnEnd = document.getElementById('restart-btn-end');
        const exitBtnEnd = document.getElementById('exit-btn-end');
        
        // ===================================
        // ‡∫Å‡∫≤‡∫ô‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫™‡∫Ω‡∫á (‡∫ï‡ªâ‡∫≠‡∫á‡ªÑ‡∫î‡ªâ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡ªÑ‡∫ü‡∫•‡ªå‡∫™‡∫Ω‡∫á‡ªÄ‡∫´‡∫º‡∫ª‡ªà‡∫≤‡∫ô‡∫µ‡ªâ‡ªÉ‡∫™‡ªà Folder)
        // ===================================

        const audio = {
            shoot: new Audio('shoot_sound.wav'),      
            explosion: new Audio('explosion_sound.wav'), 
            error: new Audio('error_sound.wav'),    
            gameOver: new Audio('gameover_sound.wav'), 
            levelUp: new Audio('level_up_sound.wav'),
            damage: new Audio('damage_sound.wav') 
        };
        
        function playAudio(type) {
            if (audio[type]) {
                audio[type].currentTime = 0; 
                audio[type].play().catch(e => console.log("Audio play blocked:", e)); 
            }
        }
        
        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫≠‡∫±‡∫ö‡ªÄ‡∫î‡∫î Font ‡∫Ç‡∫≠‡∫á Game Container
        function updateGameFont(lang) {
            const elementsToUpdate = [gameContainer, startScreen, messageDisplay, h1Title, endGameScreen];
            
            elementsToUpdate.forEach(el => {
                el.classList.remove('lao-font', 'en-font');
                if (lang === 'lao') {
                    el.classList.add('lao-font');
                } else {
                    el.classList.add('en-font');
                }
            });
            
            document.querySelectorAll('.enemy').forEach(enemy => {
                 enemy.classList.remove('lao-font', 'en-font');
                 enemy.classList.add(lang === 'lao' ? 'lao-font' : 'en-font');
            });
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡∫≠‡∫±‡∫ö‡ªÄ‡∫î‡∫î‡∫™‡∫∞‡∫ñ‡∫¥‡∫ï‡∫¥
        function updateStats() {
            damageDisplay.textContent = damage;
            scoreDisplay.textContent = score;
            correctDisplay.textContent = correctHits;
            incorrectDisplay.textContent = incorrectHits;
            levelDisplay.textContent = currentLevel;
            
            const totalChars = allCharactersInLevel.length;
            const completedChars = totalChars - charactersRemaining.length;
            progressDisplay.textContent = currentLanguage === 'lao' 
                ? `Progress: ${completedChars} / ${totalChars} ‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô` 
                : `Progress: ${completedChars} / ${totalChars} Characters`;
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡ªâ‡∫≤‡∫á‡∫™‡∫±‡∫î‡∫ï‡∫π‡ªÇ‡∫ï‡∫ï‡ªç‡ªà‡ªÑ‡∫õ
        function spawnNextEnemy() {
            if (isGameOver) return;
            if (currentEnemy && currentEnemy.parentElement) return; 
            
            if (charactersRemaining.length === 0) {
                checkLevelComplete();
                return;
            }

            const randomChar = charactersRemaining[Math.floor(Math.random() * charactersRemaining.length)];
            const randomY = Math.max(30, Math.min(670, Math.random() * (gameContainer.clientHeight - 60))); 

            const enemy = document.createElement('div');
            enemy.classList.add('enemy');
            
            enemy.classList.add(currentLanguage === 'lao' ? 'lao-font' : 'en-font');

            enemy.textContent = randomChar;
            enemy.setAttribute('data-char', randomChar);
            enemy.style.top = `${randomY}px`;
            enemy.style.right = `-60px`; 
            
            enemy.setAttribute('data-pos-x', gameContainer.offsetWidth - 30); 
            enemy.setAttribute('data-pos-y', randomY + 30); 

            gameContainer.appendChild(enemy);
            currentEnemy = enemy; 

            moveEnemy(enemy);
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫Ç‡∫≠‡∫á‡∫™‡∫±‡∫î‡∫ï‡∫π
        function moveEnemy(enemy) {
            const speed = levels[currentLevel].speed;
            const moveInterval = 20; 
            const speedMultiplier = speed * 1.5; 

            const interval = setInterval(() => {
                if (isGameOver || !enemy.parentElement) {
                    clearInterval(interval);
                    return;
                }

                let currentRight = parseFloat(enemy.style.right) || 0;
                let newRight = currentRight + speedMultiplier; 
                
                let currentX = gameContainer.offsetWidth - newRight; 

                if (currentX <= player.offsetWidth + player.offsetLeft) { 
                    clearInterval(interval);
                    
                    enemyAttack(enemy, true); 
                    
                    if (currentEnemy === enemy) {
                        currentEnemy = null;
                    }
                    enemy.remove();
                    spawnNextEnemy(); 
                    return;
                }

                enemy.style.right = `${newRight}px`;
                enemy.setAttribute('data-pos-x', currentX - 30); 
                
            }, moveInterval);

            enemy.setAttribute('data-interval', interval);
        }
        
        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡ªâ‡∫≤‡∫á ‡ªÅ‡∫•‡∫∞ ‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫•‡∫π‡∫Å‡∫õ‡∫∑‡∫ô
        function createBullet(targetEnemy) {
            if (!targetEnemy || !targetEnemy.parentElement) return; 
            
            playAudio('shoot');

            const playerX = player.offsetLeft + player.offsetWidth;
            const playerY = player.offsetTop + (player.offsetHeight / 2) - 2.5;
            
            const bullet = document.createElement('div');
            bullet.classList.add('bullet');
            bullet.style.top = `${playerY}px`;
            bullet.style.left = `${playerX}px`;
            gameContainer.appendChild(bullet);

            const BULLET_SPEED = 25; 
            const moveInterval = 10; 

            const bulletInterval = setInterval(() => {
                if (isGameOver || !targetEnemy.parentElement) {
                    clearInterval(bulletInterval);
                    bullet.remove();
                    return;
                }

                const targetX = parseFloat(targetEnemy.getAttribute('data-pos-x'));
                const targetY = parseFloat(targetEnemy.getAttribute('data-pos-y'));
                
                let currentX = parseFloat(bullet.style.left);
                let currentY = parseFloat(bullet.style.top);
                
                const deltaX = targetX - currentX;
                const deltaY = targetY - currentY;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

                if (distance < BULLET_SPEED) {
                    clearInterval(bulletInterval);
                    bullet.remove();
                    hitEnemy(targetEnemy);
                    return;
                }
                
                const ratio = BULLET_SPEED / distance;
                const moveX = deltaX * ratio;
                const moveY = deltaY * ratio;
                
                bullet.style.left = `${currentX + moveX}px`;
                bullet.style.top = `${currentY + moveY}px`;

            }, moveInterval);
        }
        
        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡∫±‡∫î‡∫ï‡∫π‡ªÇ‡∫à‡∫°‡∫ï‡∫µ
        function enemyAttack(aggressor, isOverrun = false) {
             if (isGameOver) return;
             
             if (!aggressor) {
                 aggressor = currentEnemy;
             }

             if (!aggressor || !aggressor.parentElement) {
                 if(!isOverrun) takeDamage(null, false); 
                 return;
             }
             
             const aggressorX = parseFloat(aggressor.getAttribute('data-pos-x'));
             const aggressorY = parseFloat(aggressor.getAttribute('data-pos-y')) - 5; 
             
             const targetX = player.offsetLeft + (player.offsetWidth / 2);
             const targetY = player.offsetTop + (player.offsetHeight / 2);
             
             const bullet = document.createElement('div');
             bullet.classList.add('enemy-bullet');
             bullet.style.top = `${aggressorY}px`;
             bullet.style.left = `${aggressorX}px`;
             gameContainer.appendChild(bullet);

             const BULLET_SPEED = 15; 
             const moveInterval = 10; 

             const bulletInterval = setInterval(() => {
                 if (isGameOver) {
                     clearInterval(bulletInterval);
                     bullet.remove();
                     return;
                 }
                 
                 let currentX = parseFloat(bullet.style.left);
                 let currentY = parseFloat(bullet.style.top);
                 
                 const deltaX = targetX - currentX;
                 const deltaY = targetY - currentY;
                 const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

                 if (distance < BULLET_SPEED) {
                     clearInterval(bulletInterval);
                     bullet.remove();
                     takeDamage(aggressor, isOverrun); 
                     return;
                 }
                 
                 const ratio = BULLET_SPEED / distance;
                 const moveX = deltaX * ratio;
                 const moveY = deltaY * ratio;
                 
                 bullet.style.left = `${currentX + moveX}px`;
                 bullet.style.top = `${currentY + moveY}px`;

             }, moveInterval);
             
             if (!isOverrun) {
                 aggressor.style.backgroundColor = '#FF5252';
                 setTimeout(() => {
                     aggressor.style.backgroundColor = 'rgba(255, 165, 0, 0.9)'; 
                 }, 200);
             }
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ
        function takeDamage(aggressor, isOverrun) {
            if (isGameOver) return;
            
            playAudio('damage'); 
            
            damage++;
            damageDisplay.style.color = '#F44336';
            
            setTimeout(() => { damageDisplay.style.color = '#D32F2F'; }, 100);
            
            updateStats();

            if (damage >= maxDamage) {
                endGame(currentLanguage === 'lao' ? '‡ªÄ‡∫Å‡∫°‡∫à‡∫ª‡∫ö! ‡∫ó‡ªà‡∫≤‡∫ô‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ 15 ‡∫Ñ‡∫±‡ªâ‡∫á' : 'GAME OVER! You took 15 hits');
            }
        }
        
        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫ç‡∫¥‡∫á‡∫ñ‡∫∑‡∫Å
        function hitEnemy(enemy) {
            if (!enemy || !enemy.parentElement) return; 
            
            const charHit = enemy.getAttribute('data-char');

            const index = charactersRemaining.indexOf(charHit);
            if (index > -1) {
                charactersRemaining.splice(index, 1);
            }

            playAudio('explosion'); 
            
            clearInterval(parseInt(enemy.getAttribute('data-interval')));
            
            enemy.style.backgroundColor = '#8BC34A'; 
            enemy.textContent = 'üí•'; 
            score += 10;
            correctHits++;
            
            if (currentEnemy === enemy) {
                currentEnemy = null;
            }
            
            setTimeout(() => {
                enemy.remove();
                spawnNextEnemy(); 
            }, 100);
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫Å‡∫ß‡∫î‡∫™‡∫≠‡∫ö Level
        function checkLevelComplete() {
            if (charactersRemaining.length === 0) {
                if (currentLevel < 12) {
                    playAudio('levelUp'); 
                    
                    currentLevel++;
                    
                    const charSet = levels[currentLevel][currentLanguage];
                    allCharactersInLevel = [...charSet]; 
                    charactersRemaining = [...charSet]; 

                    const nextLevelMsg = currentLanguage === 'lao' 
                        ? `‡∫ú‡ªà‡∫≤‡∫ô Level ${currentLevel - 1} ‡ªÅ‡∫•‡ªâ‡∫ß! ‡ªÑ‡∫õ Level ${currentLevel}` 
                        : `Level ${currentLevel - 1} Complete! Next Level: ${currentLevel}`;
                    
                    messageDisplay.textContent = nextLevelMsg;
                    messageDisplay.style.display = 'block';
                    
                    setTimeout(() => {
                        messageDisplay.style.display = 'none';
                        spawnNextEnemy(); 
                        updateStats();
                    }, 3000);
                } else {
                    endGame(currentLanguage === 'lao' ? '‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î! ‡∫ó‡ªà‡∫≤‡∫ô‡∫Ñ‡∫∑‡∫ç‡∫≠‡∫î‡∫ß‡∫¥‡∫•‡∫∞‡∫ä‡∫ª‡∫ô‡ªÇ‡∫ï‡∫à‡∫¥‡∫á!' : 'CONGRATULATIONS! You are a true Letter Hero!');
                }
            }
        }

        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫õ‡∫∏‡ªà‡∫°‡∫Å‡∫ª‡∫î (‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫ö‡∫±‡∫ô‡∫´‡∫≤‡∫ï‡∫ª‡∫ß ‡∫ß)
        document.addEventListener('keydown', (e) => {
            if (isGameOver || currentLanguage === '') return;

            let typedChar = e.key;
            
            const nonTypingKeys = ['Shift', 'Control', 'Alt', 'Meta', 'Enter', 'Tab', 'CapsLock', 'Escape', 'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
            if (nonTypingKeys.includes(e.key) || e.key.length > 1 && !e.key.startsWith('U+')) {
                return; 
            }

            // LOGIC FOR LAO: ‡ªÅ‡∫õ‡∫á‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫ó‡∫µ‡ªà‡∫°‡∫±‡∫Å‡∫û‡∫ª‡∫ö‡∫ö‡∫±‡∫ô‡∫´‡∫≤ (‡ªÄ‡∫ä‡∫±‡ªà‡∫ô: v = ‡∫ß)
            if (currentLanguage === 'lao') {
                if (e.key === 'v') {
                    typedChar = '‡∫ß';
                } 
            }
            
            // ‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡∫û‡∫≤‡∫™‡∫≤‡∫≠‡∫±‡∫á‡∫Å‡∫¥‡∫î‡ªÉ‡∫´‡∫ç‡ªà/‡∫ô‡ªâ‡∫≠‡∫ç
            if (currentLanguage === 'en') {
                 typedChar = typedChar.toUpperCase();
            }
            
            const targetEnemy = currentEnemy; 

            if (targetEnemy) {
                let enemyChar = targetEnemy.getAttribute('data-char');
                
                let targetCharForMatch = enemyChar;
                if (currentLanguage === 'en') {
                    targetCharForMatch = targetCharForMatch.toUpperCase();
                }
                
                if (targetCharForMatch === typedChar) {
                    createBullet(targetEnemy); 
                } else {
                    incorrectHits++;
                    playAudio('error'); 
                    enemyAttack(targetEnemy, false); 
                }
            } else {
                incorrectHits++;
                playAudio('error');
            }
            updateStats();
        });


        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡∫™‡∫¥‡ªâ‡∫ô‡∫™‡∫∏‡∫î‡ªÄ‡∫Å‡∫° (‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡ªú‡ªâ‡∫≤‡∫à‡ªç‡∫™‡∫∞‡∫´‡∫º‡∫∏‡∫ö Overlay)
        function endGame(msg) {
            playAudio('gameOver'); 
            
            isGameOver = true;
            
            // ‡∫¢‡∫∏‡∫î ‡ªÅ‡∫•‡∫∞ ‡∫•‡∫∂‡∫ö‡∫™‡∫±‡∫î‡∫ï‡∫π/‡∫•‡∫π‡∫Å‡∫õ‡∫∑‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î
            document.querySelectorAll('.enemy').forEach(e => {
                clearInterval(parseInt(e.getAttribute('data-interval')));
                e.remove(); 
            });
            document.querySelectorAll('.bullet').forEach(b => b.remove()); 
            document.querySelectorAll('.enemy-bullet').forEach(b => b.remove()); 
            currentEnemy = null; 
            
            // 1. ‡∫ï‡∫±‡ªâ‡∫á‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫à‡∫ª‡∫ö‡ªÄ‡∫Å‡∫°
            endGameMessage.textContent = msg;
            
            // 2. ‡∫Ñ‡∫¥‡∫î‡ªÑ‡∫•‡ªà‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á
            const totalAttempts = correctHits + incorrectHits;
            const accuracy = totalAttempts > 0 ? ((correctHits / totalAttempts) * 100).toFixed(2) : '0.00'; 
            
            // 3. ‡∫™‡ªâ‡∫≤‡∫á‡∫•‡∫≤‡∫ç‡∫•‡∫∞‡∫≠‡∫Ω‡∫î‡∫™‡∫∞‡∫ñ‡∫¥‡∫ï‡∫¥ (‡ªÅ‡∫ö‡∫ö‡∫™‡∫µ‡∫î‡∫≥)
            const detailsHtml = currentLanguage === 'lao' ? `
                <p>‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫•‡∫ß‡∫°: <span class="value">${score}</span></p>
                <p>Level ‡∫™‡∫∏‡∫î‡∫ó‡ªâ‡∫≤‡∫ç: <span class="value">${currentLevel}</span></p>
                <p>‡∫û‡∫¥‡∫°‡∫ñ‡∫∑‡∫Å: <span class="value">${correctHits}</span></p>
                <p>‡∫û‡∫¥‡∫°‡∫ú‡∫¥‡∫î: <span class="value">${incorrectHits}</span></p>
                <p>‡∫ñ‡∫∑‡∫Å‡ªÇ‡∫à‡∫°‡∫ï‡∫µ: <span class="value">${damage}</span></p>
                <p>‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á: <span class="accuracy-value">${accuracy}%</span></p>
            ` : `
                <p>Total Score: <span class="value">${score}</span></p>
                <p>Max Level: <span class="value">${currentLevel}</span></p>
                <p>Correct Hits: <span class="value">${correctHits}</span></p>
                <p>Incorrect Hits: <span class="value">${incorrectHits}</span></p>
                <p>Damage Taken: <span class="value">${damage}</span></p>
                <p>Accuracy: <span class="accuracy-value">${accuracy}%</span></p>
            `;

            endGameDetails.innerHTML = detailsHtml;
            
            // 4. ‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫á Elements ‡∫Ç‡∫≠‡∫á‡ªÄ‡∫Å‡∫° ‡ªÅ‡∫•‡∫∞ ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡ªú‡ªâ‡∫≤‡∫à‡ªç‡∫à‡∫ª‡∫ö‡ªÄ‡∫Å‡∫°
            player.style.display = 'none'; 
            document.getElementById('stats').style.display = 'none'; 
            progressDisplay.style.display = 'none';
            messageDisplay.style.display = 'none';
            
            updateGameFont(currentLanguage); 
            endGameScreen.style.display = 'flex'; 
        }
        
        function restartGame() {
            // ‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫á‡ªú‡ªâ‡∫≤‡∫à‡ªç‡∫à‡∫ª‡∫ö‡ªÄ‡∫Å‡∫° ‡ªÅ‡∫•‡∫∞ ‡∫™‡∫∞‡ªÅ‡∫î‡∫á Elements ‡∫Ç‡∫≠‡∫á‡ªÄ‡∫Å‡∫°
            endGameScreen.style.display = 'none';
            player.style.display = 'block'; 
            document.getElementById('stats').style.display = 'flex';
            progressDisplay.style.display = 'block';

            initializeGame(currentLanguage);
        }
        
        function exitToMenu() {
            isGameOver = true;
            
            document.querySelectorAll('.enemy').forEach(e => { clearInterval(parseInt(e.getAttribute('data-interval'))); e.remove(); });
            document.querySelectorAll('.bullet').forEach(b => b.remove()); 
            document.querySelectorAll('.enemy-bullet').forEach(b => b.remove()); 
            
            player.style.display = 'none';
            document.getElementById('stats').style.display = 'none'; 
            progressDisplay.style.display = 'none';
            messageDisplay.style.display = 'none';
            endGameScreen.style.display = 'none';
            
            // ‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡ªú‡ªâ‡∫≤‡∫´‡∫º‡∫±‡∫Å
            startScreen.style.display = 'flex';
            
            currentLanguage = ''; 
            currentEnemy = null; 
            
            updateGameFont('lao'); 
        }


        // ‡∫ü‡∫±‡∫á‡∫ä‡∫±‡∫ô‡ªÄ‡∫•‡∫µ‡ªà‡∫°‡ªÄ‡∫Å‡∫°
        function initializeGame(lang) {
            // ‡∫ï‡ªâ‡∫≠‡∫á‡∫°‡∫µ‡∫Å‡∫≤‡∫ô‡∫û‡∫ª‡∫ß‡∫û‡∫±‡∫ô‡∫Å‡∫±‡∫ö‡ªú‡ªâ‡∫≤‡∫à‡ªç‡∫Å‡ªà‡∫≠‡∫ô‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÉ‡∫´‡ªâ‡∫™‡∫Ω‡∫á‡ªÄ‡∫Æ‡∫±‡∫î‡∫ß‡∫Ω‡∫Å
            Object.values(audio).forEach(sound => {
                sound.muted = true;
                sound.play().catch(e => console.log("Silent play blocked:", e));
                sound.muted = false;
                sound.pause();
                sound.currentTime = 0;
            });
            
            currentLanguage = lang;
            currentLevel = 1;
            score = 0;
            damage = 0;
            correctHits = 0;
            incorrectHits = 0;
            isGameOver = false;
            currentEnemy = null;
            
            updateGameFont(lang);
            
            const charSet = levels[currentLevel][currentLanguage];
            allCharactersInLevel = [...charSet]; 
            charactersRemaining = [...charSet]; 

            startScreen.style.display = 'none';
            endGameScreen.style.display = 'none'; 
            
            // ‡∫™‡∫∞‡ªÅ‡∫î‡∫á Elements ‡∫Ç‡∫≠‡∫á‡ªÄ‡∫Å‡∫°
            player.style.display = 'block';
            document.getElementById('stats').style.display = 'flex'; 
            progressDisplay.style.display = 'block';
            document.querySelectorAll('.enemy').forEach(e => e.remove()); 
            messageDisplay.style.display = 'none';

            updateStats();
            spawnNextEnemy(); 
        }

        // ‡∫ú‡∫π‡ªâ‡ªÉ‡∫ä‡ªâ‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫û‡∫≤‡∫™‡∫≤ (Start Screen)
        document.getElementById('lao-btn').addEventListener('click', () => initializeGame('lao'));
        document.getElementById('en-btn').addEventListener('click', () => initializeGame('en'));
        
        // ‡∫ú‡∫π‡∫Å‡∫õ‡∫∏‡ªà‡∫°‡∫Ñ‡∫ß‡∫ö‡∫Ñ‡∫∏‡∫°‡ªÉ‡∫ô‡ªú‡ªâ‡∫≤‡∫à‡ªç‡∫à‡∫ª‡∫ö‡ªÄ‡∫Å‡∫°
        restartBtnEnd.addEventListener('click', restartGame);
        exitBtnEnd.addEventListener('click', exitToMenu);
        
        // ‡ªÄ‡∫°‡∫∑‡ªà‡∫≠‡ªÇ‡∫´‡∫º‡∫î‡ªú‡ªâ‡∫≤‡∫à‡ªç, ‡ªÉ‡∫´‡ªâ‡∫ï‡∫±‡ªâ‡∫á Font ‡ªÄ‡∫ö‡∫∑‡ªâ‡∫≠‡∫á‡∫ï‡∫ª‡ªâ‡∫ô
        updateGameFont('lao');
        document.getElementById('stats').style.display = 'none'; 

    </script>
</body>
</html>

